<!doctype html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>OnToti Control</title>
    <link rel="stylesheet" href="/static/styles.css" />
  </head>
  <body>
    <div class="bg"></div>
    <main class="app-shell">
      <header>
        <h1>OnToti Control</h1>
        <p>Produktions-Setup, Multi-Agent-Topologie, Scheduler und Betriebssteuerung</p>
      </header>

      <nav class="tabs">
        <button class="tab active" data-tab="chat">Chat</button>
        <button class="tab" data-tab="topology">Topologie</button>
        <button class="tab" data-tab="agents">Agents</button>
        <button class="tab" data-tab="bus">Bus</button>
        <button class="tab" data-tab="ops">Operations</button>
        <button class="tab" data-tab="setup">Setup</button>
        <button class="tab" data-tab="config">Raw Config</button>
      </nav>

      <section id="chat" class="panel active">
        <div id="chat-log" class="log-box"></div>
        <form id="chat-form" class="row">
          <select id="session-id"></select>
          <input id="chat-input" placeholder="Nachricht an den Bot" />
          <button type="submit">Senden</button>
        </form>
      </section>

      <section id="topology" class="panel">
        <button id="refresh-topology">Topologie aktualisieren</button>
        <div id="topology-canvas" class="topology-canvas"></div>
      </section>

      <section id="agents" class="panel">
        <button id="refresh-agents">Aktualisieren</button>
        <pre id="agents-view" class="code-box"></pre>
      </section>

      <section id="bus" class="panel">
        <button id="refresh-bus">Bus aktualisieren</button>
        <pre id="bus-view" class="code-box"></pre>
      </section>

      <section id="ops" class="panel">
        <div class="config-grid">
          <div class="card">
            <h3>Sessions</h3>
            <div class="row wrap">
              <input id="new-session-id" placeholder="session-id" />
              <input id="new-session-name" placeholder="Anzeigename" />
              <button id="create-session">Session erstellen</button>
              <button id="reload-sessions">Sessions laden</button>
            </div>
            <pre id="sessions-view" class="code-box small"></pre>
          </div>

          <div class="card">
            <h3>Scheduler Jobs</h3>
            <div class="row wrap">
              <input id="job-name" placeholder="Job Name" />
              <input id="job-cron" value="0 */15 * * * *" placeholder="Cron (6 Felder)" />
              <select id="job-kind">
                <option value="chat_message">chat_message</option>
                <option value="heartbeat">heartbeat</option>
              </select>
              <input id="job-session" value="default" placeholder="Session ID" />
              <input id="job-text" value="Bitte gib ein kurzes Statusupdate." placeholder="Nachricht/Channel" />
              <button id="create-job">Job erstellen</button>
              <button id="reload-jobs">Jobs laden</button>
            </div>
            <pre id="jobs-view" class="code-box small"></pre>
          </div>

          <div class="card">
            <h3>Policy + Audit</h3>
            <div class="row wrap">
              <input id="policy-path" value="/Users/tito1/Desktop/Test/README.md" placeholder="Dateipfad" />
              <button id="check-path">Pfad pr端fen</button>
            </div>
            <div class="row wrap">
              <input id="policy-cmd" value="ls -la" placeholder="Shell Command" />
              <button id="check-cmd">Command pr端fen</button>
            </div>
            <div class="row wrap">
              <button id="verify-audit">Audit Chain pr端fen</button>
              <button id="reload-audit">Audit laden</button>
            </div>
            <pre id="policy-view" class="code-box small"></pre>
          </div>

          <div class="card">
            <h3>Webhooks</h3>
            <div class="row wrap">
              <input id="webhook-source" value="manual" placeholder="source" />
              <input id="webhook-text" value="Webhook Testnachricht" placeholder="text" />
              <button id="send-webhook">Webhook senden</button>
              <button id="reload-webhooks">Webhooks laden</button>
            </div>
            <pre id="webhooks-view" class="code-box small"></pre>
          </div>
        </div>
      </section>

      <section id="setup" class="panel">
        <div class="config-grid">
          <div class="card">
            <h3>1) Identity</h3>
            <input id="setup-bot-name" placeholder="Bot Name" />
            <input id="setup-bot-tone" placeholder="Ton (z. B. direkt und respektvoll)" />

            <h3>2) Provider</h3>
            <select id="setup-provider-active">
              <option value="github_models">github_models</option>
              <option value="openai">openai</option>
              <option value="anthropic">anthropic</option>
              <option value="gemini">gemini</option>
              <option value="ollama">ollama</option>
              <option value="lmstudio">lmstudio</option>
            </select>
            <input id="setup-provider-base-url" placeholder="Base URL" />
            <input id="setup-provider-model" placeholder="Model" />
            <input id="setup-provider-key-env" value="GITHUB_TOKEN" placeholder="API Key ENV Name" />
            <input id="setup-provider-key-value" type="password" placeholder="API Key (lokal gespeichert)" />

            <h3>3) Security</h3>
            <label class="inline-check"><input id="setup-sandbox-mode" type="checkbox" checked /> Sandbox aktiv</label>
            <label class="inline-check"><input id="setup-tailnet-only" type="checkbox" /> Tailnet-only Zugriff</label>
            <input id="setup-tailscale-cidrs" value="100.64.0.0/10" placeholder="Tailscale CIDRs (Komma-getrennt)" />
            <input id="setup-node-allowlist" placeholder="Tailscale Node Allowlist (Komma-getrennt)" />
            <input id="setup-allowed-paths" value="/Users/tito1/Desktop/Test" placeholder="Allow Paths (Komma-getrennt)" />

            <h3>4) Agenten + Pipeline + Bus</h3>
            <input id="setup-max-agents" value="4" type="number" min="1" max="32" placeholder="Max aktive Agenten" />
            <select id="setup-pipeline-mode">
              <option value="sequential">sequential</option>
              <option value="parallel">parallel</option>
            </select>
            <input id="setup-pipeline-retries" value="1" type="number" min="0" max="5" placeholder="Pipeline Retries" />
            <select id="setup-bus-backend">
              <option value="local">local</option>
              <option value="redis">redis</option>
            </select>
            <input id="setup-bus-redis-url" value="redis://localhost:6379/0" placeholder="Redis URL" />
          </div>

          <div class="card">
            <h3>5) Copilot Quick Setup</h3>
            <p>Optional: GitHub Token pr端fen und auf <code>github_models</code> umstellen.</p>
            <label class="inline-check"><input id="setup-use-copilot" type="checkbox" /> Copilot jetzt verbinden</label>
            <input id="setup-copilot-token" type="password" placeholder="GitHub Token" />

            <div class="row wrap">
              <button id="setup-load">Setup laden</button>
              <button id="setup-apply">Setup anwenden</button>
              <button id="setup-test-provider">Provider testen</button>
            </div>

            <p id="setup-status" class="status"></p>
            <pre id="setup-state-view" class="code-box small"></pre>
          </div>
        </div>
      </section>

      <section id="config" class="panel">
        <div class="card">
          <h3>Raw Config JSON</h3>
          <textarea id="config-editor" rows="18"></textarea>
          <div class="row">
            <button id="load-config">Laden</button>
            <button id="save-config">Speichern</button>
          </div>
        </div>
      </section>
    </main>

    <script src="/static/app.js"></script>
  </body>
</html>
